/*! File: add_favorite.js | Build: 2013-05-22-11:18:40 | Revision: 55028 */
goods.utils.addFavorite=function(b,d){var a=function(){var e="你可以按{0}键收藏爱乐活，随时发现精彩分享！".format(Browser.platform.match(/Mac/i)?"Command+D":"Ctrl+D");alert(e);};try{window.sidebar?window.sidebar.addPanel(d,b,""):document.all?window.external.AddFavorite(b,d):a();}catch(c){a();}return false;};goods.utils.setHome=function(b){var a=b.href||window.location;try{b.style.behavior="url(#default#homepage)";b.setHomePage(a);}catch(c){window.open("http://www.leho.com");}return false;};
/*! File: cross_msg.js | Build: 2013-05-22-11:18:40 | Revision: 55028 */
(function(){var c=0,h,f;var b=function(k,j,i){if(k.attachEvent){k[j+i]=function(){return i.call(k,event);};k.attachEvent("on"+j,k[j+i]);}else{k.addEventListener(j,i,false);}return i;};var e=function(){if(window.postMessage){b(window,"message",a);}else{d(window,"name");}};var d=function(i,m){var l="";function j(n){var o=n.split("^").pop().split("&");return{domain:o[0],data:window.unescape(o[1])};}function k(){var n=i[m];if(n!=l){l=n;a(j(n));}}h=setInterval(k,1000/20);};var a=function(j){j=j||window.event;var k=unescape(j.data);var i=QW.StringH.queryUrl(k);f&&f(i);};e();window.CrossMsg={};CrossMsg.sendMessage=function(k,i){if(!k){return;}if(typeof k!="object"){return;}var j=QW.ObjectH.encodeURIJson(i);j=escape(j);if(window.postMessage){k.postMessage(j,"*");}else{k.name=(new Date()).getTime()+(c++)+"^"+document.domain+"&"+window.escape(j);}};CrossMsg.receiveMessage=function(i){f=i;};})();
/*! File: broadcast.js | Build: 2013-05-22-11:18:40 | Revision: 55028 */
var GDS=function(){var b={},a={};b.register=function(c,f){var e=c.split("."),d=b;moduleName=null;while(moduleName=e.shift()){if(e.length){if(d[moduleName]===undefined){d[moduleName]={};}d=d[moduleName];}else{if(d[moduleName]===undefined){d[moduleName]=f(b);}}}};b.regAlias=function(c,d){if(b[c]!==undefined){throw"["+c+"] : short : has been register";}b[c]=d;};b.add=function(){var c=arguments[0],f=arguments[arguments.length-1],e,d;if(typeof f==="function"){if(typeof c==="string"){e=QW.namespace(c,GDS);if(!a[c]){a[c]={isLoaded:true,returnValue:d};}}f(e);}else{throw new Error("Function required");}};b.checkModule=function(c){return GDS.PACKAGES[c];};return b;}();GDS.register("core.util.listener",function(a){return function(){var e={},l,j=[],k;function i(){if(j.length!=0){clearTimeout(k);var c=j.splice(0,1)[0];try{c.func.apply(c.func,[].concat(c.data));}catch(d){}k=setTimeout(i,25);}}var h={conn:function(){var b=window;while(b!=top){b=b.parent;b.GDS&&b.GDS.core&&b.GDS.core.util&&b.GDS.core.util.listener!=null&&(l=b);}},register:function(b,f,c){if(l!=null){l.GDS.core.util.listener.register(b,f,c);}else{e[b]=e[b]||{};e[b][f]=e[b][f]||[];e[b][f].push(c);}},fire:function(b,n,m){if(l!=null){l.GDS.core.util.listener.fire(b,n,m);}else{var f,d,c;if(e[b]&&e[b][n]&&e[b][n].length>0){f=e[b][n];f.__cache__=m;for(d=0,c=f.length;d<c;d++){j.push({channel:b,evt:n,func:f[d],data:m});}i();}}},remove:function(b,o,n){if(l!=null){l.GDS.core.util.listener.remove(b,o,n);}else{if(e[b]&&e[b][o]){for(var m=0,c=e[b][o].length;m<c;m++){if(e[b][o][m]===n){e[b][o].splice(m,1);break;}}}}},list:function(){return e;},cache:function(b,c){if(l!=null){return l.GDS.core.util.listener.cache(b,c);}if(e[b]&&e[b][c]){return e[b][c].__cache__;}}};return h;}();});(function(){var e=GDS.core,d={listener:e.util.listener};for(var f in d){GDS.regAlias(f,d[f]);}})();GDS.register("common.listener",function(d){var a={},e={};e.define=function(b,c){if(a[b]!=null){throw"common.listener.define: 频道已被占用";}a[b]=c;var f={};f.register=function(i,h){if(a[b]==null){throw"common.listener.define: 频道未定义";}d.listener.register(b,i,h);};f.fire=function(i,h){if(a[b]==null){throw"common.listener.define: 频道未定义";}d.listener.fire(b,i,h);};f.remove=function(h,i){d.listener.remove(b,h,i);};f.cache=function(h){return d.listener.cache(b,h);};return f;};return e;});
/*! File: list_action.js | Build: 2013-05-22-11:18:40 | Revision: 55028 */
(function(){var a=function(b){this.init(b);};ObjectH.mix(a.prototype,{init:function(b){if(ObjectH.isString(b)){this.lpid=b;}else{this.lpid=W(b).attr("data-lpid");}},del:function(c){var b=this;Panel.confirm("你确定要删除吗？",function(d){if(d){Ajax.post("/goods/common/_delGoods",{_of:"json",r:new Date().getTime(),lpid:b.lpid},function(h){var f=this.opResults(h,false);if(f.err=="mcphp.ok"){GDS.common.channel.goods.fire("delete",b.lpid);c(b.lpid);}else{Panel.alert("删除失败！");}});}});},add:function(b){Ajax.post("/goods/common/_buildFeed",{_of:"json",r:new Date().getTime(),lpid:this.lpid},function(f){var c=this.opResults(f,false);if(c.err=="mcphp.ok"){var d=Dom.create(c.data.html);b(d);}});}});goods.utils.listAction={listW:null,init:function(){this.listW=W(".prlist .prlist-inner");this.bindEvent();},bindEvent:function(){var b=this;this.listW.delegate(".lproot","mouseover",function(){W(this).addClass("hover");}).delegate(".lproot","mouseout",function(){W(this).removeClass("hover");}).delegate(".lproot .del","click",function(){var c=W(this).parentNode(".lproot");b.delItem(c);});},delItem:function(c){var b=this;(new a(c)).del(function(){W(c).fadeOut(500,function(){W(c).removeNode();if(b.listW.firstChild().length==0){location.reload();}});});},addItem:function(d,b){var c=this;(new a(d)).add(function(e){W(e).hide();if(b){c.listW.appendChild(e);}else{c.listW.prepend(e);}W(e).fadeIn(500);W(".prlist-empty").removeNode();});}};goods.utils.listAction.init();})();
/*! File: feedback.js | Build: 2013-05-22-11:18:40 | Revision: 55028 */
(function(){var b='		<form action="/sns/talkleho/_add" method="post" id="feed_back_form">			<input type="hidden" name="feedback_type" value="11" />			<div class="feedback-content">				<textarea id="feedback_content" name="feedback_content" placeholder="提问吐槽提建议，赶紧告诉我们吧！ "></textarea>			</div>			<div class="button-wrapper cls">				<div id="feedback_error" class="feedback-error" style="display:none">请输入10~2000个字符的内容</div>				<div class="panel-btn"><a href="javascript:;" id="feedback_confirm" class="btn"><span>提交</span></a></div>			</div>		</form>';var a=function(){this.dialog=null;this.init();};ObjectH.mix(a.prototype,{init:function(){this.dialog=new BasePanel({wrapId:"feedbackPanel",className:"panel-t7 feedback-box",title:"提建议",dragable:1,body:b,withMask:true,posCenter:true,withClose:true,keyEsc:true,posAdjust:true});this.bindEvent();},show:function(){this.dialog.show();},dispose:function(){this.dialog.hide();this.dialog.dispose();},bindEvent:function(){var c=this;W("#feedback_confirm").click(function(d){d.preventDefault();c.sendRequest();});W("#feedback_content").focus(function(){W("#feedback_error").hide();});},sendRequest:function(){var c=this;Ajax.post(g("feed_back_form"),function(d){var e=this.opResults(d,false);if(e.err=="mcphp.ok"){c.dialog.hide();Panel.alert("反馈成功");}else{if(e.err=="mcphp.u_input"){W("#feedback_error").show();}else{if(e.err!="mcphp.u_login"){Panel.error("反馈失败");}}}});}});goods.utils.feedback={dialog:null,init:function(){W(".feedback").show().click(function(c){c.preventDefault();goods.utils.feedback.show();});},show:function(){if(this.dialog){this.dialog.dispose();}this.dialog=new a();this.dialog.show();}};goods.utils.feedback.init();})();
/*! File: count_valid_editor.js | Build: 2013-05-22-11:18:40 | Revision: 55028 */
(function(){var f=QW.ObjectH,e=QW.CustEvent,d=QW.EventTargetH,h=QW.EventH,c=QW.DomU,b=QW.NodeH,a=QW.StringH;goods.widgets.CountValidEditor=function(){this.config={minRange:{count:30,message:"还需要输入<span>{0}</span>个字"},maxRange:{count:110,message:"超出<span>{0}</span>个字"}};this.timer=null;this.initialize.apply(this,arguments);};f.mix(goods.widgets.CountValidEditor.prototype,function(){var i=["remainCount","rangeState"];var j=false;return{initialize:function(m,k){var l=this;l.host=m;e.createEvents(l,i);f.mix(l,k||{},true);l.bindEvents();},isInRange:function(){return j;},checkTextLength:function(){var n=this;var o=n.config.minRange;var p=n.config.maxRange;var m=Math.ceil(a.byteLen(n.host.value)/2);var k=parseInt(n.limitCount,10)-m;this.fire("remainCount",{remainCount:k});if(k<o.count){this.fire("");}var l={};j=true;if(m<o.count){j=false;l.message=o.message.format(o.count-m);}if(m>p.count){j=false;l.message=p.message.format(m-p.count);}this.fire("rangeState",l);},bindEvents:function(){var l=this,k=this.host;d.on(k,"focus",function(){this.timer=setInterval(function(){l.checkTextLength();},32);});d.on(k,"blur",function(){clearInterval(this.timer);});}};}(),true);})();
/*! File: goods_panel.js | Build: 2013-05-22-11:18:40 | Revision: 55028 */
(function(){var f=QW.ObjectH.mix,a=QW.CustEvent;var c=function(h){this.initialize.apply(this,arguments);};c.EVENTS=["success","fail"];f(c.prototype,function(){return{initialize:function(i){var h=this;h.form=i;a.createEvents(h,c.EVENTS);},fetchGoodsInfo:function(i){var h=this;if(Valid.checkAll(h.form)){Ajax.post(h.form,function(k){var j=Ajax.opResults(k,false);if(j.err=="mcphp.ok"){h.fire("success",{genGoodsTpl:j.data.genGoodsTpl});}else{h.fire("fail");}});}}};}(),true);var e=function(){this.panel=null;};f(e.prototype,function(){var i='<div class="publish-bd"><div class="info-get">				<form method="post" id="get_goods_form" action="/goods/common/_getGoodsInfo" onsubmit="return false;">					<input type="text" id="get_goods_url" name="get_goods_url" reqMsg="请输入宝贝" placeholder="请输入宝贝的链接地址" class="ipt" />					<button type="submit" id="get_goods_btn" class="publish-btn publish-btn-next">确定</button>					<p class="tip">目前仅支持添加淘宝、天猫的宝贝链接哦</p>				</form>			</div>';var h='<div class="panel-content">			<div class="bd">				<div class="bb-confirm-success">					<h4>发布成功！</h4>					<p><a class="link" target="_blank" href="{0}">去看看&raquo;</a></p>				</div>			</div>		</div>';return{initGetGoodsSence:function(){var j=this;if(j.panel!=null){j.panel.hide();j.panel.dispose();}j.panel=new BasePanel({wrapId:"genGoodsPanel",className:"panel-t6 publish",title:"发宝贝",body:i,withMask:true,posCenter:true,withClose:true,keyEsc:true,posAdjust:true});j.panel.show();Valid.initAll();g("get_goods_btn").onclick=function(){var k=new c(g("get_goods_form"));k.on("success",function(l){j.initGenGoodsSence(l.genGoodsTpl);});k.on("fail",function(){W(".publish-bd p.tip").html("无法获取宝贝信息，请检查链接是否正确，再重新试试。").addClass("error");});k.fetchGoodsInfo();};},initGenGoodsSence:function(o){var l=this;var k=false;W(".publish .bd").html(o);l.panel.show();Valid.initAll();new b();d();var n=g("goods_reason_editor");var m=W(".publish .tip");var j=new goods.widgets.CountValidEditor(n);j.on("rangeState",function(p){m.removeClass("error");if("message" in p){m.html(p.message).css("visibility","visible");}else{m.css("visibility","hidden");}});W("#gen_goods_btn").click(function(){if(k){return false;}if(j.isInRange()){k=true;var q=[];W(".list").query("img").forEach(function(r){q.push(r.getAttribute("data-origin-src"));});g("thumbnails").value=q.join("|");g("cover_img_url").value=W(".list").query("a._cover img").attr("data-origin-src");var p=document.genGoodsForm;Ajax.post(p,function(r){k=false;var t=Ajax.opResults(r,false);if(t.err=="mcphp.ok"){l.panel.hide();var s=new LayerPopup({className:"panel-t6",title:"",withClose:false,body:h.format(G_CONF.lp_post_url+"/"+t.data.goods_id),withMask:true,posCenter:true,keyEsc:true});s.show(null,null,300);setTimeout(function(){s.hide();},3000);GDS.common.channel.goods.fire("add",t.data.goods_id);}});}else{W(n).shine4Error();m.addClass("error");}});}};}(),true);var b=function(){this.switchDelayTime=300;this.switchTimer=null;this.initialize.apply(this,arguments);};f(b.prototype,function(){return{initialize:function(h){var i=this;f(i,h||{},true);i.bindEvents();},bindEvents:function(){var h=this;W(".info-show").delegate(".cell","mouseover",function(){clearTimeout(h.switchTimer);var i=W(this);h.switchTimer=setTimeout(function(){h.hoverThumbnail(i);},h.switchDelayTime);});W(".info-show").delegate(".setting-op","click",function(i){h.setGoodsCover(i,W(this));});W(".info-show").delegate(".op","click",function(){h.removeThumbnail(this);});},hoverThumbnail:function(i){var h=W(".preview");h.query("img").set("src",i.query("img").attr("data-cover-src"));h.setAttr("data-index",i.attr("data-index"));if(i.hasClass("_uncover")){h.removeClass("cover").query(".cover-text").html("设为封面");}else{h.addClass("cover").query(".cover-text").html("封面");}},setGoodsCover:function(j,h){var i=W(".preview");if(i.hasClass("cover")){j.preventDefault();}else{i.addClass("cover").query(".cover-text").html("封面");W(".cell").replaceClass("_cover","_uncover");W("."+i.attr("data-index")).replaceClass("_uncover","_cover");}},removeThumbnail:function(j){var i=W(".preview");W(j).parentNode(".cell").removeNode();if(i.hasClass("cover")){var h=W(W(".cell")[0]);h.replaceClass("_uncover","_cover");}i.query("img").attr("src",W("._cover").query("img").attr("data-cover-src"));i.addClass("cover");if(W(".cell").length==1){W(".publish-bd .list").addClass("only");}}};}(),true);goods.widgets.goodsFetch=function(){var h=new e();return{show:function(){h.initGetGoodsSence();}};}();function d(){var i=W(".share-list"),h=i.query(".ico_"),k=g("share_tip"),j=W("#share_tip .share-tips");i.appendChild(k);h.on("click",function(o){var l=W(this);var n=W(this).nextSibling("input.data").val().split(","),m=n[0]||0;if(m&14){if(l.hasClass("lighted")){l.set("className","ico-{0}".format(l.attr("data-v")));l.nextSibling("input.data").val(n[0]+",0");j.setHtml("点击后开启同步");}else{l.addClass("ico-{0}-lighted lighted".format(l.attr("data-v")));l.nextSibling("input.data").val(n[0]+",1");j.setHtml("点击后取消同步");}}}).on("mouseover",function(){var l=W(this);var m=l.getXY()[0]-l.parentNode(".share-list").getXY()[0]-25;if(l.hasClass("lighted")){j.setHtml("点击后取消同步");}else{j.setHtml("点击后开启同步");}W(k).css("left",m+"px").show("block");}).on("mouseout",function(){W(k).hide();});i.hover(function(){W(".set-syn-in").css("visibility","visible");},function(){W(".set-syn-in").css("visibility","hidden");});}DomU.ready(function(){var h=W(".goods-widgets-fetchgoods");if(h[0]){h.un("click");h.click(function(i){i.preventDefault();User.Power.login(function(){goods.widgets.goodsFetch.show();});});}});})();
/*! File: user.js | Build: 2013-05-22-11:18:40 | Revision: 55028 */
var User=function(){var j=QW.ObjectH,m=QW.CustEvent,d=QW.StringH,n=QW.EventH,f=QW.EventTargetH,e=QW.loadJs,q=QW.Env,i=QW.NodeH.$;var p="http://i.leho.com";var c={SINA:p+"/psp/login/third/sina",QQ:p+"/psp/login/third/qq",RENREN:p+"/psp/login/third/renren",BAIDU:p+"/psp/login/third/baidu"};var o=function(){this.data=null;this.view=null;this.ref=null;this._handles={};this._init.apply(this,arguments);this.logoutUrl="";};j.mix(o.prototype,{_init:function(r){j.mix(this,r,true);},logout:function(){location.href=this.logoutUrl;},login:function(s,r){r=r||{};this.data.complete(function(t){if(t.isLogin&&!r.otherLogin){s&&s(t);}else{var u={};j.mix(u,r,true);k.renderLogin(u);k.onlogin=function(){if(u.loginOk){User.Data._complete=false;u.loginOk();}else{location.reload();}};}});},crossMsgCallback:function(r){if(r.isLogin){k.panel.hide();k.fire(b.EVENTS.login);}}});var b=function(){this.panel=null;this.data=null;this._init.apply(this,arguments);};b.EVENTS={login:"login",afterloginrender:"afterloginrender"};j.mix(b.prototype,{_init:function(r){var t=[];for(var s in b.EVENTS){t.push(s);}m.createEvents(this,t);j.mix(this,r,true);},renderLogin:function(s){var r=this;s=s||{};this._initPanel();this.panel.show();},_initPanel:function(){if(!this.panel){var s=a.ref?"?ref="+a.ref:"";var r={className:"panel-t6 login-panel",header:"<h3>登录</h3>",body:'<iframe src="'+G_CONF.psp_site_url+"/psp/mini/login"+s+'" class="userLoginIframe" scrolling="auto" frameborder="0" width="540" height="300"></iframe>',withClose:true,withCorner:true,withCue:true,withShadow:false,withBgIframe:true,keyEsc:true,withMask:true,dragable:false,resizable:false,posCenter:true,posAdjust:false,width:540};this.panel=new QW.BasePanel(r);this.panel.show();if(this.panel.oBgIframe){this.panel.oBgIframe.style.height="330px";}}}});var l=function(){j.mix(this,{_complete:false,_loading:false,_handlers:[],_data:{isLogin:false}});this._init.apply(this,arguments);};j.mix(l.prototype,{siteUrl:p+"/data/sns_topbar?t="+new Date().getTime(),_init:function(r){m.createEvents(this,"change");j.mix(this,r,true);},_boolean:function(r){return r==0?false:true;},_callBack:function(){var r=this;if(r._loading){return;}r._loading=true;r._complete=false;e(this.siteUrl,null,{charset:"gb2312"});},_process:function(v){var r=this;r._loading=false;r._complete=true;r._data=v.data;r._data.isLogin=r._boolean(v.data.is_login);if(r._data.isLogin){r._data.loginName=v.data.uname;r._data.uid=v.data.uid;r._data.loginNickname=v.data.nickname;r._data.head_imid=v.data.__snsUser__.head_imid;}for(var u=0,t=this._handlers.length;u<t;u++){this._dispatch(this._handlers[u]);}this._handlers=[];var s=new m(this,"change");s.info=r._data;this.fire(s);},_dispatch:function(r){r.call(null,this._data);},complete:function(r){if(this._complete){this._dispatch(r);}else{this._handlers.push(r);this._callBack();}},updata:function(){this.clear();this._callBack();},clear:function(){this._complete=false;}});var h=new l,k=new b({data:h}),a=new o({data:h,view:k});CrossMsg.receiveMessage(a.crossMsgCallback);return{Data:h,View:k,Power:a};}();
/*! File: like.js | Build: 2013-05-22-11:18:40 | Revision: 55028 */
(function(){goods.widgets.like=(function(){var b=QW.ObjectH.mix;var a=true;var c=function(d){this.el=d;this.elW=W(d);this.likeStatus=this.elW.hasClass("btn-liked");this.likeNum=parseInt(this.elW.query("em").html())||0;this.lpid=this.elW.attr("data-lpid")||this.elW.parentNode(".lproot").attr("data-lpid");};b(c.prototype,{action:function(){if(!this.lpid){alert("良品id有误");return;}var d=this;User.Power.login(function(){d.sendRequest();a&&d.setLikeStatus(!d.likeStatus);a&&d.sendBroadcast();});},sendRequest:function(){var d=this;Ajax.post("/goods/common/_like",{lpid:this.lpid,_of:"json",stamp:(+new Date)},function(h){var f=this.opResults(h,false);if(f.err=="mcphp.ok"){a||d.setLikeStatus(f.data.is_like);a||d.sendBroadcast();}else{if(f.err=="jt.u_arg.post_del"){MessageBox.alert({caption:"提示",content:"该分享已删除。"});a&&d.setLikeStatus(!d.likeStatus);a&&d.setLikeStatus();}}});},setLikeStatus:function(d){this.likeStatus=d;this.setIcon(d);this.setNum(d?this.likeNum+1:this.likeNum-1);},setIcon:function(d){if(d){this.elW.addClass("btn-liked");}else{this.elW.removeClass("btn-liked");}},setNum:function(d){d=d<0||isNaN(d)?0:d;this.likeNum=d;var e=this.elW.query("span em");if(!e.length){e=W(Dom.create("<em>")).hide();this.elW.query("span").appendChild(e);e.fadeIn(300);}if(!d){e.fadeOut(300,function(){e.removeNode();});}else{e.html(d);}},sendBroadcast:function(){var d=this.likeStatus?"add":"remove";GDS.common.channel.like.fire(d,this.lpid);}});return{init:function(d){W(d||"#body").delegate(".btn-like","click",function(f){f.preventDefault();(new c(this)).action();});}};})();goods.widgets.like.init();})();
/*! File: follow.js | Build: 2013-05-22-11:18:40 | Revision: 55028 */
(function(){goods.widgets.follow=(function(){var d=QW.ObjectH.mix;var c=false;var b=function(e){this.el=e;this.elW=W(e);this.uid=this.elW.attr("data-uid")||this.elW.parentNode(".userroot").attr("data-uid");this.followStatus=this.elW.hasClass("btn-follow-26-add")?0:(this.elW.hasClass("btn-follow-26-end")?1:2);};var a=['<a class="btn-follow-26-add follow-add" href="javascript:;" data-uid="{$uid}"><span>加关注</span></a>','<div class="btn-follow-26-end" data-uid="{$uid}"><span>已关注</span><a href="javascript:;" class="follow-cancel">取消</a></div>','<div class="btn-follow-26-each" data-uid="{$uid}"><span>相互关注</span><a href="javascript:;" class="follow-cancel">取消</a></div>'];d(b.prototype,{action:function(){if(!this.uid){alert("用户id有误");return;}var e=this;User.Power.login(function(){e.sendRequest();c&&e.setFollowStatus(!e.followStatus+0);c&&e.sendBroadcast(e.followStatus>0?"add":"remove");});},sendRequest:function(){var e=this;Ajax.post("/goods/common/_follow",{uid:this.uid,_of:"json",stamp:(+new Date)},function(h){var f=this.opResults(h,false);if(f.err=="mcphp.ok"){if(!c||f.data.relation!=e.followStatus){e.setFollowStatus(f.data.relation);c||e.sendBroadcast(f.data.relation>0?"add":"remove");}}else{MessageBox.alert({caption:"提示",content:"添加关注出错。"});c&&e.setFollowStatus(!e.followStatus+0);c&&e.sendBroadcast(e.followStatus>0?"add":"remove");}});},setFollowStatus:function(e){this.followStatus=e;this.el=Dom.create(a[e].tmpl({uid:this.uid}));this.elW.replaceNode(this.el);this.elW=W(this.el);},sendBroadcast:function(e){GDS.common.channel.follow.fire(e,this.uid);}});return{init:function(e){W(e||"#body").delegate(".follow-add,.follow-cancel","click",function(h){h.preventDefault();var f=this;if(f.className=="follow-cancel"){f=f.parentNode;}(new b(f)).action();});}};})();goods.widgets.follow.init();})();
/*! File: page_scroll.js | Build: 2013-05-22-11:18:40 | Revision: 55028 */
(function(){var a=QW.NodeW;var b=function(){this.initialize.apply(this,arguments);};b.prototype=(function(){var d,k,e,q,o,i,f;var j=200;var m=function(){var t,r,s=a(e.doc).item(0);!!s&&(t=s.getRect().right+e.elementOffsetLeft);r=Dom.getDocRect().width-d.getRect().width-e.elementOffsetRight;isNaN(t)?t=r:t=Math.min(t,r);d.css("left",t+"px");o=null;};var p=function(){var r=Dom.getDocRect().scrollY;if(r<e.showOffsetTop){if(QW.Browser.ie6){d.show();k.hide();}else{k.fadeOut(j,function(){k.hide();});}}else{if(QW.Browser.ie6){d.show();k.show();}else{k.show();k.fadeIn(j);}}q=null;};var n=function(){if(o){clearTimeout(o);}o=setTimeout(m,j);};var c=function(){if(q){clearTimeout(q);}else{QW.Browser.ie6&&d.hide();}q=setTimeout(p,j);};var h=function(t,r){var s=0;if(ObjectH.isPlainObject(r)){if(Dom.isElement(r.offset)){s=a(r.offset).getRect().height;}else{s=r.offset|0;}r=r.callback;}t=t||e.top;if(Dom.isElement(t)){t=a(t).getRect().top;}t=Math.max(t-s,0);if(QW.Browser.ie6||e.dur<=0){f.scrollTop=t;r&&typeof(r)=="function"&&r();}else{if(i){i.un("suspend");if(i.isPlay()){return;}}i=new ScrollAnim(f,{scrollTop:{to:t}},e.dur,e.easing);r&&typeof(r)=="function"&&i.on("suspend",r);i.play();}};var l=function(){var s=document.documentElement,r=document.documentElement.scrollTop++;if(r==document.documentElement.scrollTop){document.documentElement.scrollTop--;if(r==document.documentElement.scrollTop){s=document.body;}}return s;};return{initialize:function(){e={dur:1000,top:0,doc:"bd",easing:Easing.easeBothStrong,showOffsetTop:125,elementOffsetLeft:20,elementOffsetRight:10,elementOffsetBottom:10};f=l();if(Dom.isElement(arguments[0])){this.element=arguments[0];e=QW.ObjectH.mix(e,arguments[1],true);}else{if(typeof(arguments[0])=="string"){this.element=Dom.create(arguments[0]);this.element.style.visibility="hidden";a("body").appendChild(this.element);e=QW.ObjectH.mix(e,arguments[1],true);}else{this.element=Dom.create('<div class="fix-block-r"><a class="back-top" href="javascript:;"></a></div>');this.element.style.visibility="hidden";a("body").appendChild(this.element);var r=arguments[0];if(!ObjectH.isPlainObject(r)&&ObjectH.isPlainObject(arguments[1])){r=arguments[1];}e=QW.ObjectH.mix(e,r,true);}}this.ops=e;this.render(this.element);},render:function(r){d=a(r);k=d.query(".back-top");d.css("bottom",e.elementOffsetBottom+"px");k.on("click",function(s){s.preventDefault;h(e.top);});Dom.on(window,"resize",n);Dom.on(window,"scroll",c);m();p();setTimeout(function(){d.css("visibility","visible");},j);},show:function(){d.show();m();},hide:function(){d.hide();},dispose:function(){Dom.un(window,"resize",n);Dom.un(window,"scroll",c);},scrollTo:function(s,r){h(s,r);}};})();QW.provide({PageScroll:b});})();
/*! File: common_retouch.js | Build: 2013-05-22-11:18:40 | Revision: 55028 */
(function(){function a(){var c,b;for(c in broadcast_conf){b=broadcast_conf[c];b=ObjectH.isArray(b)?b:[b];GDS.register("common.channel."+c,function(d){return d.common.listener.define("common.channel."+c,b);});}}a();Dom.ready(function(){if(typeof G_CONF.page_scroller!="undefined"&&!G_CONF.page_scroller){return;}goods.page.pageScroll=new PageScroll(W(".fix-block-r")[0],{dur:0,doc:"#body",elementOffsetLeft:20,elementOffsetBottom:10});if(W(".fix-block-index").length>0){W(".fix-block-index").delegate("a","click",function(){W(".fix-block-index a").removeClass("on");W(this).addClass("on");});var c=150;var b=function(){var d=Dom.getDocRect().scrollY;W(".container .to-fix").forEach(function(e){var h=W(e).getXY()[1];if((h-d)<=c){var f=e.getAttribute("data-category");W(".fix-block-index a").removeClass("on");W(".fix-block-index a."+f).addClass("on");}});};W(window).on("scroll",b);}});Dom.ready(function(){var b=W("img.lazy-load");var d={lazyloaderType:"imager",onafterload:function(){this.getCurrent().fadeIn();}};var c=new LazyLoader(b,d);c.dealWithDisplay();});Dom.ready(function(){var b=(function(){var c=function(k,l){k.hover(function(){l.show();},function(){l.hide();});};var d=function(k,l){var m;k.on("mouseover",function(){clearTimeout(m);l.show();}).on("mouseout",function(){m=setTimeout(function(){l.hide();},400);});};var i=function(){setTimeout(function(){W(".header-module-follow-more").html(W("#header-follow-us").val());d(W(".header-module-follow"),W(".header-module-follow .header-module-follow-more"));},10);};var h=function(){if(Browser.ie6||(location.href.indexOf("faxian")>=0)){return;}function m(){var o=Math.max(document.body.scrollTop,document.documentElement.scrollTop);if(o>=n){k.addClass("header-fixed");l.css("margin-bottom","75px");}else{k.removeClass("header-fixed");l.css("margin-bottom","0px");}}var l=W(".header-module-hd");var k=W(".header-module-bd");var n=W(".header-module-bd").first().getXY()[1];W(window).on("scroll",m);};var e={};var f=function(){W(".header-module-nav").delegate("li.tag","mouseover",function(){var k=W(this);var l=k.attr("data-cid");if(!l){return;}if(e[l]){e[l].query("li").length>0&&e[l].show();}else{Ajax.get("/goods/common/getTagsById",{cid:l,_of:"json"},function(q){var m=Ajax.opResults(q,false);if(m.err=="mcphp.ok"){var o=m.data.tags;var s='<div class="sub-menu-items" style=""><div class="arrow-top"><i></i></div><ul class="sub-menu">';var r=k.firstChild("a")[0].href;for(var p=0,n=o.length;p<n;p++){s+='<li><a href="'+r+"/"+o[p].tid+'">'+o[p].tname+"</a></li>";}s+="</ul></div>";var t=e[l]=W(s);if(o.length>0){k.appendChild(t[0]);t.show();}}});}}).delegate("li.tag","mouseout",function(){W(this).query(".sub-menu-items").hide();});};var j=function(){c(W(".header-module-container"),W(".header-module-container .header-module-guides-list"));i();if(G_CONF.login_uid!="0"){d(W(".header-module-user-info"),W(".header-module-user-info .header-module-user-menulist"));c(W(".header-module-user-menulist li.more"),W(".header-module-user-menulist li.more ul.header-module-user-sublist"));}h();};return{setToggle:c,laterToggle:d,init:j,getTags:f};})();b.init();});})();